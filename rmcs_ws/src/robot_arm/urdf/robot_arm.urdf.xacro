<?xml version="1.0" encoding="utf-8"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="robot_arm">

  <xacro:arg name="mesh_path" default="package://robot_arm/meshes/" />
  <xacro:property name="mesh_path" value="$(arg mesh_path)" />

  <!-- 参数配置 -->
  <xacro:property name="joint_names" value="['joint1', 'joint2', 'joint3', 'joint4']" />
  <xacro:property name="joint_limit_lower" value="-3.14159" />
  <xacro:property name="joint_limit_upper" value="3.14159" />
  <xacro:property name="joint_effort" value="100" />
  <xacro:property name="joint_velocity" value="1.0" />
  
  <!-- PID控制器参数 -->
  <xacro:property name="p_gain" value="10" />   
  <xacro:property name="i_gain" value="0" />    
  <xacro:property name="d_gain" value="2" />    

  <!-- Base Link -->
  <link name="base_link">
    <inertial>
      <origin xyz="0.00349046211360322 -0.000343265194728414 0.045094182873056" rpy="0 0 0" />
      <mass value="10.00505117450335" />
      <inertia
        ixx="0.00220854266265005" ixy="-2.54728284829126E-05" ixz="-4.35307141610758E-07"
        iyy="0.0019616293162622" iyz="2.14439742958395E-07" izz="0.00405006058283794" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="${mesh_path}base_link.STL" />
      </geometry>
      <material name="">
        <color rgba="0.792156862745098 0.819607843137255 0.933333333333333 1" />
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0.03" rpy="0 0 0" />
      <geometry>
        <cylinder radius="0.06" length="0.06"/>
      </geometry>
    </collision>
  </link>
  
  <!-- Link 1 -->
  <link name="Link1">
    <inertial>
      <origin xyz="0.00222691011447779 -0.000103445186121577 -0.0489878006161306" rpy="0 0 0" />
      <mass value="0.730127057991041" />
      <inertia
        ixx="0.000799772837117555" ixy="-1.31346900301297E-06" ixz="3.35950732929857E-05"
        iyy="0.000766589757827449" iyz="-1.41874721294391E-06" izz="0.00129660339371665" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="${mesh_path}Link1.STL" />
      </geometry>
      <material name="">
        <color rgba="0.792156862745098 0.819607843137255 0.933333333333333 1" />
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 -0.05" rpy="0 0 0" />
      <geometry>
        <box size="0.06 0.06 0.1"/>
      </geometry>
    </collision>
  </link>
  
  <!-- Joint 1 -->
  <joint name="joint1" type="revolute">
    <origin xyz="0 0 0.0612" rpy="-3.1416 0 0.0096884" />
    <parent link="base_link" />
    <child link="Link1" />
    <axis xyz="0 0 1" />
    <limit lower="${joint_limit_lower}" upper="${joint_limit_upper}" 
           effort="${joint_effort}" velocity="${joint_velocity}" />
    <dynamics damping="0.5" friction="0.1"/>
  </joint>
  
  <!-- Link 2 -->
  <link name="Link2">
    <inertial>
      <origin xyz="-1.03700037052453E-05 0.256542749285097 -0.0326276072927307" rpy="0 0 0" />
      <mass value="0.791156109971724" />
      <inertia
        ixx="0.00979567104770538" ixy="1.57083356028265E-08" ixz="4.18417663786553E-08"
        iyy="0.000285533998138127" iyz="-5.37192648050834E-10" izz="0.00983223443892208" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="${mesh_path}Link2.STL" />
      </geometry>
      <material name="">
        <color rgba="1 1 1 1" />
      </material>
    </visual>
    <collision>
      <origin xyz="0 0.22 0" rpy="0 0 0" />
      <geometry>
        <box size="0.05 0.44 0.05"/>
      </geometry>
    </collision>
  </link>
  
  <!-- Joint 2 -->
  <joint name="joint2" type="revolute">
    <origin xyz="-0.033472 0.001365 -0.1043" rpy="-1.5708 0.056736 1.53" />
    <parent link="Link1" />
    <child link="Link2" />
    <axis xyz="0 0 -1" />
    <limit lower="${joint_limit_lower}" upper="${joint_limit_upper}" 
           effort="${joint_effort}" velocity="${joint_velocity}" />
    <dynamics damping="0.7" friction="0.15"/>
  </joint>
  
  <!-- Link 3 -->
  <link name="Link3">
    <inertial>
      <origin xyz="-4.26112190471395E-06 -0.255430754861549 0.0409457209445715" rpy="0 0 0" />
      <mass value="0.859300672395829" />
      <inertia
        ixx="0.00963783294095957" ixy="1.33464090732295E-07" ixz="-5.38944624605547E-10"
        iyy="0.000326145651166138" iyz="-1.65727535933605E-07" izz="0.00956968209161652" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="${mesh_path}Link3.STL" />
      </geometry>
      <material name="">
        <color rgba="1 1 1 1" />
      </material>
    </visual>
    <collision>
      <origin xyz="0 -0.22 0" rpy="0 0 0" />
      <geometry>
        <box size="0.05 0.44 0.05"/>
      </geometry>
    </collision>
  </link>
  
  <!-- Joint 3 -->
  <joint name="joint3" type="revolute">
    <origin xyz="0 0.4332 -0.074" rpy="0 0 0.80011" />
    <parent link="Link2" />
    <child link="Link3" />
    <axis xyz="0 0 1" />
    <limit lower="${joint_limit_lower}" upper="${joint_limit_upper}" 
           effort="${joint_effort}" velocity="${joint_velocity}" />
    <dynamics damping="0.5" friction="0.1"/>
  </joint>
  
  <!-- Link 4 -->
  <link name="Link4">
    <inertial>
      <origin xyz="-0.0387015346365765 1.53196899610464E-12 0.0237326102111524" rpy="0 0 0" />
      <mass value="0.10266604078042" />
      <inertia
        ixx="9.32654519509942E-05" ixy="-6.43745039913268E-20" ixz="3.05824287610215E-05"
        iyy="0.000121251354325632" iyz="9.35971406716002E-20" izz="5.50250171861243E-05" />
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="${mesh_path}Link4.STL" />
      </geometry>
      <material name="">
        <color rgba="0.792156862745098 0.819607843137255 0.933333333333333 1" />
      </material>
    </visual>
    <collision>
      <origin xyz="-0.04 0 0.02" rpy="0 0 0" />
      <geometry>
        <box size="0.08 0.04 0.04"/>
      </geometry>
    </collision>
  </link>
  
  <!-- Joint 4 -->
  <joint name="joint4" type="revolute">
    <origin xyz="0 -0.44 0.089" rpy="3.1416 0 0.39372" />
    <parent link="Link3" />
    <child link="Link4" />
    <axis xyz="0 0 -1" />
    <limit lower="${joint_limit_lower}" upper="${joint_limit_upper}" 
           effort="${joint_effort}" velocity="${joint_velocity}" />
    <dynamics damping="0.3" friction="0.05"/>
  </joint>

<!-- ros2_control 硬件接口定义 -->
<!--true/false    仿真/硬件-->
<ros2_control name="robot_arm_hardware" type="system">
  <hardware>
    <plugin>unitree_hardware/UnitreeHardwareInterface</plugin>
    <param name="use_sim_mode">true</param>
    <param name="usb_pid">64974</param>
  </hardware>
  
  <!-- Joint 1 GO1仿真 -->
  <joint name="joint1">
    <command_interface name="position"/>
    <state_interface name="position">
      <param name="initial_value">0.0</param>
    </state_interface>
    <state_interface name="velocity"/>
    <state_interface name="effort"/>

    <param name="motor_type">GO1</param>
    <param name="motor_id">1</param>
    <param name="reduction_ratio">6.3</param>
    <param name="zero_offset">0.0</param>
    <param name="kp">3.0</param>
    <param name="kd">0.2</param>
    <param name="is_simulated">true</param>
  </joint>
  
  <!-- Joint 2 GO1真实电机 -->
  <joint name="joint2">
    <command_interface name="position"/>
    <state_interface name="position">
      <param name="initial_value">0.0</param>
    </state_interface>
    <state_interface name="velocity"/>
    <state_interface name="effort"/>

    <param name="motor_type">GO1</param>
    <param name="motor_id">4</param>
    <param name="reduction_ratio">6.3</param>
    <param name="zero_offset">0.0</param>
    <param name="kp">3</param>          
    <param name="kd">0.2</param>       
    <param name="is_simulated">true</param>
  </joint>
  
  <!-- Joint 3 GO1真实电机 -->
  <joint name="joint3">
    <command_interface name="position"/>
    <state_interface name="position">
      <param name="initial_value">0.0</param>
    </state_interface>
    <state_interface name="velocity"/>
    <state_interface name="effort"/>

    <param name="motor_type">GO1</param>
    <param name="motor_id">3</param>
    <param name="reduction_ratio">6.3</param>
    <param name="zero_offset">0.0</param>

    <param name="kp">3</param>
    <param name="kd">0.2</param>
    <param name="is_simulated">true</param>
  </joint>
  
  <!-- Joint 4 DJI2006仿真 -->
  <joint name="joint4">
    <command_interface name="position"/>
    <state_interface name="position">
      <param name="initial_value">0.0</param>
    </state_interface>
    <state_interface name="velocity"/>
    <state_interface name="effort"/>

    <param name="motor_type">DJI</param>
    <param name="motor_id">4</param>
    <param name="reduction_ratio">36.0</param>
    <param name="zero_offset">0.0</param>
    <param name="kp">0.8</param>
    <param name="kd">0.2</param>
    <param name="is_simulated">true</param>

    <param name ="can_bus">1</param>
    <param name ="can_id">0x203</param>
  </joint>
</ros2_control>

</robot>
